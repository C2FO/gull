---
layout: page
title:  "Gull User Guide"
permalink: v0.10.0/user-guide
group: user
version: v0.10.0
---

## Workflow

Gull serves two purposes. First, it prepares configuration migrations. Second, it uses those migrations to manage etcd.

### Migrations

A migration file for gull defines the values for specific keys in etcd. Here's an example.

`_gull/1464809219-backpack.yaml`

```YAML
---
entries:
- path: "/default/battleCops"
  value: "76"
- path: "/default/preWarHoney"
  value: "21"  
- path: "/default/stimpoks"
  value: "7"
- path: "/production/battleCops"
  value: "834"
```

By default, gull will store migration files in the `_gull` directory. The order migrations are applied is based on the timestamp leading each migration's name.

These migrations can be written by hand or generated from traditional configuration formats.

A near-empty config migration can be generated by running `gull new --name production-key-rotation`. This will create the `_gull` directory if it doesn't exist and make a skeleton config migration. The `--name` flag is required to describe what the migration contains. This file can be opened with a text editor and edited like any other plain old YAML file.

If your configuration management client (such as [gostrufig](https://github.com/brockwood/gostrufig)) supports plaintext configuration values, then creating and editing config files by hand will be easy.

Alternatively, your configuration management client might expect a different format. [gofigure](https://github.com/c2fo/gofigure) supports loading from etcd, but expects all values to be stored as serialized JSON. In this case, converting an existing configuration file to a gull migration will be the smoothest path forward.

### Converting Configuration Files

In most cases, your application already has configuration files and you are looking to move that data into etcd. Gull has you covered. Run `gull convert -i <configdir>` and gull will generate a migration file for each configuration file it encounters. There are a handful of options you can provide gull when converting existing configuration.

`gull convert` will parse each config file, use the top-level entries as environments, and spit out plain text config values.

`gull convert -f` or `gull convert -filenameisenvironment` will walk through the config directory and generate migrations treating each encountered filename as a new environment. 

`gull convert -j` or `gull convert -jsonencode` will generate migration files with values that are serialized as JSON.

Note that `-f` and -`j` are both optional flags that can be used together or ignored entirely. Whether or not you need them is dependent on the client that will be reading from etcd.

### Loading Configuration

Once migration files are ready, gull can populate etcd with their state. Gull does this by building up a configuration dataset representing a specific environment. Let's look at an example using `_gull/1464809219-wallet.yaml` from above, and the following command.

`gull up --application infall --environment production --etcdhost "http://localhost:2379/v2/keys"`

This command loads etcd with configuration for our app "InFall" that will be read by the `production` environment. Here's what that data looks like if you read it from etcd.

```Bash
battleCops: 834
preWarHoney: 21
stimpoks: 7
```

If you compare that output to the migration above, you will notice that `battleCops` is set to the value found under the `/production/` path instead of the "76" found under `/default/`. You will also notice that we didn't need to define the other two values for production. 

This is were gull shines. Instead of repeating configurations for separate environments, or building complicated override logic into your configuration management client, you can use etcd as a single source of truth. Gull will load all `/default/` values into any environment, and then override the defaults with any values specific to that environment.

### Backing Out Configuration

If you find that a configuration migration breaks a system, then gull can undo migrations one at a time.

`gull down --application infall --environment production --etcdhost "http://localhost:2379/v2/keys"`

Running this command will destroy all configuration for an environment and re-run all but the latest migration for an environment.